<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Birthday Hijinks</title>
    <!-- React and ReactDOM CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Babel CDN for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js" charset="utf-8"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chewy&family=Delius&family=Modak&display=swap"
        rel="stylesheet">

    <style>
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: "Chewy", cursive;
            font-weight: 400;
            font-style: normal;
        }

        body {
            font-family: "Delius", cursive;
            background-color: white;
            color: black;

        }

        #title {
            font-family: 'Modak', cursive;
            font-size: 80px;
            color: rgb(240, 160, 204);
            text-shadow: 5px 3px 0px black;
        }

        #back {
            background-image: url('bkground.gif');
            background-repeat: repeat;
            z-index: -10;
            height: 100vh;
            width: 100vw;
            position: fixed;
            top: 0;
            left: 0;
            opacity: 0.5;
        }

        #result {
            background-color: #ff0066;
        }

        @keyframes fadein {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .fadein {
            opacity: 1;
            animation-name: fadein;
            animation-duration: 0.1s;
        }

        .no-image {
            background-color: rgb(214, 213, 213);
            color: gray;
        }

        .read-more-link {
            color: #ff0066;
        }

        .read-more-link:hover {
            color: #ffbb00;
        }
    </style>
</head>

<body>
    <!-- Root container -->
    <div id="back"></div>
    <div id="root"></div>
    <!-- Script to render React -->
    <script type="text/babel">

        const pops = {
            "Date": { "0": -2208988800000, "1": -2208902400000, "2": -2208816000000, "3": -2208729600000, "4": -2208643200000, "5": -2208556800000, "6": -2208470400000, "7": -2208384000000, "8": -2208297600000, "9": -2208211200000, "10": -2208124800000, "11": -2208038400000, "12": -2207952000000, "13": -2207865600000, "14": -2207779200000, "15": -2207692800000, "16": -2207606400000, "17": -2207520000000, "18": -2207433600000, "19": -2207347200000, "20": -2207260800000, "21": -2207174400000, "22": -2207088000000, "23": -2207001600000, "24": -2206915200000, "25": -2206828800000, "26": -2206742400000, "27": -2206656000000, "28": -2206569600000, "29": -2206483200000, "30": -2206396800000, "31": -2206310400000, "32": -2206224000000, "33": -2206137600000, "34": -2206051200000, "35": -2205964800000, "36": -2205878400000, "37": -2205792000000, "38": -2205705600000, "39": -2205619200000, "40": -2205532800000, "41": -2205446400000, "42": -2205360000000, "43": -2205273600000, "44": -2205187200000, "45": -2205100800000, "46": -2205014400000, "47": -2204928000000, "48": -2204841600000, "49": -2204755200000, "50": -2204668800000, "51": -2204582400000, "52": -2204496000000, "53": -2204409600000, "54": -2204323200000, "55": -2204236800000, "56": -2204150400000, "57": -2204064000000, "58": -2203977600000, "62": -2203891200000, "63": -2203804800000, "64": -2203718400000, "65": -2203632000000, "66": -2203545600000, "67": -2203459200000, "68": -2203372800000, "69": -2203286400000, "70": -2203200000000, "71": -2203113600000, "72": -2203027200000, "73": -2202940800000, "74": -2202854400000, "75": -2202768000000, "76": -2202681600000, "77": -2202595200000, "78": -2202508800000, "79": -2202422400000, "80": -2202336000000, "81": -2202249600000, "82": -2202163200000, "83": -2202076800000, "84": -2201990400000, "85": -2201904000000, "86": -2201817600000, "87": -2201731200000, "88": -2201644800000, "89": -2201558400000, "90": -2201472000000, "91": -2201385600000, "92": -2201299200000, "93": -2201212800000, "94": -2201126400000, "95": -2201040000000, "96": -2200953600000, "97": -2200867200000, "98": -2200780800000, "99": -2200694400000, "100": -2200608000000, "101": -2200521600000, "102": -2200435200000, "103": -2200348800000, "104": -2200262400000, "105": -2200176000000, "106": -2200089600000, "107": -2200003200000, "108": -2199916800000, "109": -2199830400000, "110": -2199744000000, "111": -2199657600000, "112": -2199571200000, "113": -2199484800000, "114": -2199398400000, "115": -2199312000000, "116": -2199225600000, "117": -2199139200000, "118": -2199052800000, "119": -2198966400000, "120": -2198880000000, "121": -2198793600000, "122": -2198707200000, "124": -2198620800000, "125": -2198534400000, "126": -2198448000000, "127": -2198361600000, "128": -2198275200000, "129": -2198188800000, "130": -2198102400000, "131": -2198016000000, "132": -2197929600000, "133": -2197843200000, "134": -2197756800000, "135": -2197670400000, "136": -2197584000000, "137": -2197497600000, "138": -2197411200000, "139": -2197324800000, "140": -2197238400000, "141": -2197152000000, "142": -2197065600000, "143": -2196979200000, "144": -2196892800000, "145": -2196806400000, "146": -2196720000000, "147": -2196633600000, "148": -2196547200000, "149": -2196460800000, "150": -2196374400000, "151": -2196288000000, "152": -2196201600000, "153": -2196115200000, "154": -2196028800000, "155": -2195942400000, "156": -2195856000000, "157": -2195769600000, "158": -2195683200000, "159": -2195596800000, "160": -2195510400000, "161": -2195424000000, "162": -2195337600000, "163": -2195251200000, "164": -2195164800000, "165": -2195078400000, "166": -2194992000000, "167": -2194905600000, "168": -2194819200000, "169": -2194732800000, "170": -2194646400000, "171": -2194560000000, "172": -2194473600000, "173": -2194387200000, "174": -2194300800000, "175": -2194214400000, "176": -2194128000000, "177": -2194041600000, "178": -2193955200000, "179": -2193868800000, "180": -2193782400000, "181": -2193696000000, "182": -2193609600000, "183": -2193523200000, "184": -2193436800000, "186": -2193350400000, "187": -2193264000000, "188": -2193177600000, "189": -2193091200000, "190": -2193004800000, "191": -2192918400000, "192": -2192832000000, "193": -2192745600000, "194": -2192659200000, "195": -2192572800000, "196": -2192486400000, "197": -2192400000000, "198": -2192313600000, "199": -2192227200000, "200": -2192140800000, "201": -2192054400000, "202": -2191968000000, "203": -2191881600000, "204": -2191795200000, "205": -2191708800000, "206": -2191622400000, "207": -2191536000000, "208": -2191449600000, "209": -2191363200000, "210": -2191276800000, "211": -2191190400000, "212": -2191104000000, "213": -2191017600000, "214": -2190931200000, "215": -2190844800000, "216": -2190758400000, "217": -2190672000000, "218": -2190585600000, "219": -2190499200000, "220": -2190412800000, "221": -2190326400000, "222": -2190240000000, "223": -2190153600000, "224": -2190067200000, "225": -2189980800000, "226": -2189894400000, "227": -2189808000000, "228": -2189721600000, "229": -2189635200000, "230": -2189548800000, "231": -2189462400000, "232": -2189376000000, "233": -2189289600000, "234": -2189203200000, "235": -2189116800000, "236": -2189030400000, "237": -2188944000000, "238": -2188857600000, "239": -2188771200000, "240": -2188684800000, "241": -2188598400000, "242": -2188512000000, "243": -2188425600000, "244": -2188339200000, "245": -2188252800000, "246": -2188166400000, "247": -2188080000000, "248": -2187993600000, "249": -2187907200000, "250": -2187820800000, "251": -2187734400000, "252": -2187648000000, "253": -2187561600000, "254": -2187475200000, "255": -2187388800000, "256": -2187302400000, "257": -2187216000000, "258": -2187129600000, "259": -2187043200000, "260": -2186956800000, "261": -2186870400000, "262": -2186784000000, "263": -2186697600000, "264": -2186611200000, "265": -2186524800000, "266": -2186438400000, "267": -2186352000000, "268": -2186265600000, "269": -2186179200000, "270": -2186092800000, "271": -2186006400000, "272": -2185920000000, "273": -2185833600000, "274": -2185747200000, "275": -2185660800000, "276": -2185574400000, "277": -2185488000000, "279": -2185401600000, "280": -2185315200000, "281": -2185228800000, "282": -2185142400000, "283": -2185056000000, "284": -2184969600000, "285": -2184883200000, "286": -2184796800000, "287": -2184710400000, "288": -2184624000000, "289": -2184537600000, "290": -2184451200000, "291": -2184364800000, "292": -2184278400000, "293": -2184192000000, "294": -2184105600000, "295": -2184019200000, "296": -2183932800000, "297": -2183846400000, "298": -2183760000000, "299": -2183673600000, "300": -2183587200000, "301": -2183500800000, "302": -2183414400000, "303": -2183328000000, "304": -2183241600000, "305": -2183155200000, "306": -2183068800000, "307": -2182982400000, "308": -2182896000000, "309": -2182809600000, "310": -2182723200000, "311": -2182636800000, "312": -2182550400000, "313": -2182464000000, "314": -2182377600000, "315": -2182291200000, "316": -2182204800000, "317": -2182118400000, "318": -2182032000000, "319": -2181945600000, "320": -2181859200000, "321": -2181772800000, "322": -2181686400000, "323": -2181600000000, "324": -2181513600000, "325": -2181427200000, "326": -2181340800000, "327": -2181254400000, "328": -2181168000000, "329": -2181081600000, "330": -2180995200000, "331": -2180908800000, "332": -2180822400000, "333": -2180736000000, "334": -2180649600000, "335": -2180563200000, "336": -2180476800000, "337": -2180390400000, "338": -2180304000000, "339": -2180217600000, "341": -2180131200000, "342": -2180044800000, "343": -2179958400000, "344": -2179872000000, "345": -2179785600000, "346": -2179699200000, "347": -2179612800000, "348": -2179526400000, "349": -2179440000000, "350": -2179353600000, "351": -2179267200000, "352": -2179180800000, "353": -2179094400000, "354": -2179008000000, "355": -2178921600000, "356": -2178835200000, "357": -2178748800000, "358": -2178662400000, "359": -2178576000000, "360": -2178489600000, "361": -2178403200000, "362": -2178316800000, "363": -2178230400000, "364": -2178144000000, "365": -2178057600000, "366": -2177971200000, "367": -2177884800000, "368": -2177798400000, "369": -2177712000000, "370": -2177625600000, "371": -2177539200000 },
            "Count": { "0": 354, "1": 225, "2": 240, "3": 225, "4": 251, "5": 285, "6": 266, "7": 251, "8": 233, "9": 236, "10": 246, "11": 268, "12": 210, "13": 263, "14": 246, "15": 222, "16": 290, "17": 245, "18": 240, "19": 248, "20": 231, "21": 261, "22": 231, "23": 207, "24": 207, "25": 226, "26": 256, "27": 241, "28": 227, "29": 226, "30": 271, "31": 293, "32": 255, "33": 242, "34": 241, "35": 236, "36": 223, "37": 208, "38": 222, "39": 266, "40": 253, "41": 254, "42": 256, "43": 237, "44": 285, "45": 250, "46": 260, "47": 245, "48": 259, "49": 248, "50": 280, "51": 248, "52": 293, "53": 240, "54": 251, "55": 283, "56": 238, "57": 254, "58": 274, "62": 280, "63": 225, "64": 230, "65": 350, "66": 251, "67": 237, "68": 232, "69": 234, "70": 213, "71": 243, "72": 240, "73": 251, "74": 247, "75": 240, "76": 268, "77": 228, "78": 241, "79": 283, "80": 230, "81": 248, "82": 214, "83": 221, "84": 264, "85": 239, "86": 244, "87": 244, "88": 243, "89": 264, "90": 226, "91": 220, "92": 222, "93": 273, "94": 229, "95": 270, "96": 263, "97": 228, "98": 220, "99": 213, "100": 231, "101": 247, "102": 227, "103": 234, "104": 266, "105": 292, "106": 244, "107": 259, "108": 264, "109": 237, "110": 241, "111": 211, "112": 211, "113": 199, "114": 233, "115": 262, "116": 243, "117": 237, "118": 231, "119": 202, "120": 197, "121": 246, "122": 198, "124": 261, "125": 225, "126": 236, "127": 209, "128": 244, "129": 240, "130": 193, "131": 248, "132": 220, "133": 266, "134": 245, "135": 223, "136": 248, "137": 270, "138": 258, "139": 220, "140": 240, "141": 228, "142": 214, "143": 260, "144": 236, "145": 198, "146": 260, "147": 251, "148": 248, "149": 188, "150": 247, "151": 235, "152": 236, "153": 209, "154": 248, "155": 221, "156": 217, "157": 234, "158": 243, "159": 227, "160": 226, "161": 189, "162": 229, "163": 206, "164": 214, "165": 222, "166": 236, "167": 238, "168": 202, "169": 222, "170": 236, "171": 229, "172": 223, "173": 200, "174": 227, "175": 268, "176": 203, "177": 206, "178": 228, "179": 217, "180": 227, "181": 222, "182": 218, "183": 220, "184": 207, "186": 227, "187": 205, "188": 206, "189": 223, "190": 219, "191": 209, "192": 208, "193": 199, "194": 217, "195": 245, "196": 238, "197": 205, "198": 194, "199": 220, "200": 225, "201": 215, "202": 230, "203": 232, "204": 218, "205": 242, "206": 224, "207": 209, "208": 248, "209": 249, "210": 211, "211": 209, "212": 243, "213": 207, "214": 209, "215": 196, "216": 246, "217": 258, "218": 261, "219": 208, "220": 210, "221": 214, "222": 229, "223": 196, "224": 265, "225": 221, "226": 265, "227": 245, "228": 242, "229": 246, "230": 244, "231": 264, "232": 246, "233": 228, "234": 223, "235": 261, "236": 219, "237": 222, "238": 249, "239": 233, "240": 242, "241": 214, "242": 226, "243": 231, "244": 233, "245": 209, "246": 195, "247": 221, "248": 211, "249": 199, "250": 210, "251": 216, "252": 223, "253": 256, "254": 243, "255": 275, "256": 223, "257": 209, "258": 228, "259": 219, "260": 239, "261": 225, "262": 223, "263": 247, "264": 249, "265": 221, "266": 243, "267": 211, "268": 217, "269": 241, "270": 214, "271": 229, "272": 236, "273": 211, "274": 221, "275": 266, "276": 276, "277": 223, "279": 230, "280": 227, "281": 218, "282": 230, "283": 229, "284": 190, "285": 231, "286": 248, "287": 234, "288": 254, "289": 206, "290": 218, "291": 226, "292": 219, "293": 220, "294": 204, "295": 193, "296": 226, "297": 213, "298": 231, "299": 201, "300": 196, "301": 202, "302": 235, "303": 238, "304": 226, "305": 206, "306": 209, "307": 199, "308": 243, "309": 234, "310": 234, "311": 237, "312": 239, "313": 219, "314": 219, "315": 198, "316": 215, "317": 219, "318": 216, "319": 245, "320": 231, "321": 201, "322": 218, "323": 216, "324": 185, "325": 218, "326": 212, "327": 208, "328": 207, "329": 245, "330": 190, "331": 226, "332": 248, "333": 233, "334": 202, "335": 230, "336": 228, "337": 202, "338": 213, "339": 227, "341": 232, "342": 211, "343": 207, "344": 214, "345": 200, "346": 224, "347": 210, "348": 241, "349": 205, "350": 205, "351": 216, "352": 249, "353": 219, "354": 235, "355": 201, "356": 208, "357": 209, "358": 214, "359": 215, "360": 209, "361": 217, "362": 212, "363": 227, "364": 210, "365": 252, "366": 215, "367": 200, "368": 239, "369": 200, "370": 223, "371": 196 }
        }

        const WeekdayDropdown = ({ value, onChange }) => {
            const weekdays = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];

            return (
                <div>
                    <label>Pick a Weekday:</label>
                    <select name='weekday' value={value} onChange={onChange} className='form-select'>
                        <option value='' disabled hidden>Choose a weekday...</option>
                        {weekdays.map((day, index) => (
                            <option key={index} value={day.toLowerCase()}>
                                {day}
                            </option>
                        ))}
                    </select>
                </div>
            );
        };

        const App = () => {
            const [formData, setFormData] = React.useState({ birthday: '', weekday: '' });
            const [output, setOutput] = React.useState(null);
            const [onThisDay, setOnThisDay] = React.useState(null);
            const [loading, setLoading] = React.useState(false); // New state for loading spinner
            const [bdayCount, setBdayCount] = React.useState(null);

            const weekdayMap = {
                "sunday": 0, "monday": 1, "tuesday": 2, "wednesday": 3, "thursday": 4, "friday": 5, "saturday": 6
            };

            const rWeekdayMap = Object.fromEntries(
                Object.entries(weekdayMap).map(([key, value]) => [value, key])
            );

            const handleSubmit = async (event) => {
                event.preventDefault();
                if (!formData.birthday || !formData.weekday) {
                    setOutput("Please select both a weekday and your birthday.");
                    return;
                }

                let year;
                let years;
                const birthdate = new Date(formData.birthday);

                let birthday = new Date(birthdate); // Ensure it's a new Date object to avoid mutating the original date
                const weekday = formData.weekday;
                const today = new Date();

                const weekdayNumber = weekdayMap[weekday.toLowerCase()];

                if (birthday.getDate() === 29 && birthday.getMonth() === 1) {
                    const diff = 2024 - today.getFullYear();
                    year = 2024;
                    years = diff;
                } else {
                    year = today.getFullYear();
                    years = 0;
                }

                birthday.setFullYear(year); // Start with the current year

                // Check if the birthday already falls on the chosen weekday
                if (birthday.getDay() !== weekdayNumber || (birthday < today && birthday.getDay() === weekdayNumber)) {
                    while (birthday.getDay() !== weekdayNumber || birthday < today) {
                        if (birthday.getDate() === 29 && birthday.getMonth() === 1) {
                            year += 4;
                            birthday.setFullYear(year);
                            years += 4;
                        } else {
                            year++;
                            birthday.setFullYear(year);
                            years++;
                        }
                    }
                }

                if (years === 0) {
                    setOutput(
                        `Your birthday falls on ${weekday.charAt(0).toUpperCase() + weekday.slice(1)} this year!`
                    );
                } else if (years === 1) {
                    setOutput(
                        `Your birthday will fall on ${weekday.charAt(0).toUpperCase() + weekday.slice(1)} next year!`
                    );
                } else {
                    setOutput(
                        `Your birthday will fall on ${weekday.charAt(0).toUpperCase() + weekday.slice(1)} in ${years} years, in the year ${year}!`
                    );
                }



                // Fetch interesting facts
                async function fetchFacts() {
                    setLoading(true); // Show spinner
                    const year = birthdate.getFullYear();
                    const month = String(birthdate.getMonth() + 1).padStart(2, '0');
                    const day = String(birthdate.getDate()).padStart(2, '0');
                    const url = `https://api.wikimedia.org/feed/v1/wikipedia/en/featured/${new Date().getFullYear() - 1}/${month}/${day}`;

                    try {
                        const response = await fetch(url, {
                            headers: {
                                'Authorization': 'Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiI1M2NhMzJkMjFkMDc3MmVkMjAwNjQ3MTMwZDUyMTJlYiIsImp0aSI6Ijc3NGZmMzk2MTUyOWQ3MTNjNjI1YjRhOGE2MTY2NDAyNzFiZDQ1ZjM2MGU2ZDgwYjM2MTcwYzM0ZDAxNTNjNTMwOTk5YzRkMDM1MTQxYzc0IiwiaWF0IjoxNzM3NTg5MjkyLjgzNDU3NywibmJmIjoxNzM3NTg5MjkyLjgzNDU4LCJleHAiOjMzMjk0NDk4MDkyLjgzMTE5Miwic3ViIjoiNzc0NjAxNzQiLCJpc3MiOiJodHRwczovL21ldGEud2lraW1lZGlhLm9yZyIsInJhdGVsaW1pdCI6eyJyZXF1ZXN0c19wZXJfdW5pdCI6NTAwMCwidW5pdCI6IkhPVVIifSwic2NvcGVzIjpbImJhc2ljIl19.jDqCkfkaLSmQf6Nqp_yleRzCx-_L8qals_D5rglSfVnYyC3QZLSq9WQNIVFoNGmhJAnO7G2PZUCX1ag0ISMlyAcyFSY5u1Qq4lvvcWLMZJQoMiYfaQYLH_DTYtt2qPmPKbkxW2bhz09a7j9KF3sHc5HgTipvHEFUXg7G4ZK9wR9UB6u3DjN701hVU4y9OdxnJPhl8TnGUDRfpQIVmGDHbfkeXUdw5HXvxOouzU7COxwTYRoIPRNBx9XuNsBrR1s6KX4EiBcVvFRQZZjN3Y9wFuti37puHmj_SaIvG6ugd7N1SpRHVf5HME-WwZOiof18VvZ_RRY2Li0OYhwSus0zXNq9q0csiRqHxz7wJRZRZSms1zlKVJVd6c_FSu5woDEIvpgO56R6TTPem133jRaRFFYSkehh56ns4x1rZyiYpjeyI75cIr_xKG6nkT0xdXwUbmkFzmk3ZxZn16JIAUQopSTQgHznNsWJ4vdnZcE4DhMrXRzfSwPjT7z5k0LJk8rytSQye3CXAusLlA1CSmU8lr9s1ho1F6Pm9msYQaRX8uANzPalIQADrB9yurKSFSh6Ee5yQfkPRGpL_ltFDETKkr33f4clRODloy-TsxcuIDfZTXi7h1OfLhUVYrFSpdDmABrfB8kiMipzasQ_KtlkOgMyexetA_NTXvBbBHC26J4',
                                'Api-User-Agent': 'rofhima13@gmail.com'
                            }
                        });
                        const data = await response.json();

                        if (data && data.onthisday && data.onthisday.length > 0) {
                            setOnThisDay(data.onthisday);
                        } else {
                            setOnThisDay([]);
                        }
                    } catch (error) {
                        console.error('Error fetching data:', error);
                        setOnThisDay([]);
                    } finally {
                        setLoading(false); // Hide spinner
                    }
                }

                fetchFacts();
            };

            const handleChange = (event) => {
                const { name, value } = event.target;
                setFormData((prevData) => ({ ...prevData, [name]: value }));
            };

            const PlotlyChart = ({ bday }) => {
                const { useState, useEffect } = React;

                useEffect(() => {
                    // Prepare data for Plotly
                    const dates = Object.values(pops.Date).map((timestamp) => {
                        const dat = new Date(timestamp);
                        const day = dat.getDate().toString().padStart(2, '0'); // Ensure two digits
                        const mon = (dat.getMonth() + 1).toString().padStart(2, '0'); // Ensure two digits
                        // Use a fixed year (1900) to allow for correct date handling
                        return new Date(`1900-${mon}-${day}`); // Create Date object with fixed year
                    });
                    const counts = Object.values(pops.Count);

                    // Convert bday to a Date object and format as MM-DD
                    const birthday = new Date(bday);
                    const bdayFormatted = `${(birthday.getMonth() + 1).toString().padStart(2, '0')}-${birthday.getDate().toString().padStart(2, '0')}`;

                    // Find the count value corresponding to the user's birthday
                    const bdayIndex = dates.findIndex(date => {
                        return `${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}` === bdayFormatted;
                    });
                    const bdayCount = bdayIndex !== -1 ? counts[bdayIndex] : Math.max(...counts); // Default to max if no match

                    setBdayCount(bdayCount);

                    const data = [
                        {
                            x: dates,
                            y: counts,
                            type: 'bar',
                            marker: { color: 'gold' },
                            name: 'Celebrity population birthdays'
                        },
                        {
                            // Invisible trace for the birthday, to show up in the legend
                            x: [new Date(`1900-${bdayFormatted}`).toISOString()],
                            y: [bdayCount], // Use the same y value as the celebrity population for the birthday
                            type: 'scatter',
                            mode: 'markers',
                            marker: { color: '#ff0066' },
                            name: `Your birthday (${birthday.toDateString()})`,
                        }
                    ];

                    const layout = {
                        title: `Population Over Time`,
                        xaxis: {
                            title: 'Date',
                            tickformat: '%B-%d', // Show month-day format (e.g., 01-01)
                        },
                        yaxis: { title: 'Count' },
                        showlegend: false
                    };

                    // Render the plot
                    window.Plotly.newPlot('plot', data, layout);
                }, [bday]); // Re-run the effect if the birthday changes

                return <div id="plot" className='fadein' style={{ width: '100%', }} />;
            };


            return (
                <div className='p-3 d-flex flex-column align-items-center'>
                    <h1 id='title'>BIRTHDAY HIJINKS</h1>
                    <form onSubmit={handleSubmit} className='border p-3 mb-3 bg-light shadow fadein' style={{ maxWidth: '1200px' }}>
                        <h1>Whenâ€™s the next time my birthday will be on this weekday?</h1>
                        <WeekdayDropdown value={formData.weekday} onChange={handleChange} />
                        <div>
                            <label>When is your birthday?</label>
                            <input type='date' value={formData.birthday} max={new Date().toISOString().split('T')[0]} onChange={handleChange} id="birthday" name="birthday" className='form-control' />
                        </div>
                        <hr />
                        <button type='submit' className='btn btn-primary'>Submit</button>
                    </form>

                    <div>
                        {loading ? (
                            <div className='text-center m-4'>
                                <div className="spinner-border" role="status">
                                    <span className="visually-hidden">Loading...</span>
                                </div>
                                <p>Loading results...</p>
                            </div>
                        ) : (

                            onThisDay && onThisDay.length > 0 ? (
                                <div className="album w-100">
                                    {output && (
                                        <div className='bg-muted mb-3 p-5 text-white rounded shadow text-shadow fadein' id='result'>
                                            <h1>{output}</h1>
                                            <h3>Some tidbits:</h3>
                                            <ul>
                                                <li>You were born on a {rWeekdayMap[new Date(formData.birthday).getDay()].charAt(0).toUpperCase() + rWeekdayMap[new Date(formData.birthday).getDay()].slice(1)}!</li>
                                                <li>You have been alive for:
                                                    <ul>
                                                        <li>{((new Date() - new Date(formData.birthday)) / 1000 / 60 / 60 / 24 / 365.25).toFixed(0)} years.</li>
                                                        <li>{((new Date() - new Date(formData.birthday)) / 1000 / 60 / 60 / 24 / 12).toFixed(0)} months.</li>
                                                        <li>{((new Date() - new Date(formData.birthday)) / 1000 / 60 / 60 / 24 / 7).toFixed(0)} weeks.</li>
                                                        <li>{((new Date() - new Date(formData.birthday)) / 1000 / 60 / 60 / 24).toFixed(0)} days.</li>
                                                        <li>About {((new Date() - new Date(formData.birthday)) / 1000 / 60 / 60).toFixed(0)} minutes.</li>
                                                    </ul>
                                                </li>
                                                <li>
                                                    Your next birthday will be in {
                                                        (() => {
                                                            const today = new Date();
                                                            const birthdayThisYear = new Date(formData.birthday);
                                                            birthdayThisYear.setFullYear(today.getFullYear());

                                                            // If the birthday has already passed this year, set it to next year
                                                            if (today > birthdayThisYear) {
                                                                birthdayThisYear.setFullYear(today.getFullYear() + 1);
                                                            }

                                                            // Calculate the difference in days
                                                            const diffInTime = birthdayThisYear - today;
                                                            const diffInDays = diffInTime / (1000 * 60 * 60 * 24);

                                                            return diffInDays.toFixed(0);
                                                        })()
                                                    } days.
                                                </li>

                                            </ul>
                                        </div>
                                    )}
                                    <h2>How popular is your birthday?</h2>
                                    <div className='bg-white border p-3 w-100 shadow mb-3'>
                                        <PlotlyChart bday={new Date(formData.birthday)} />
                                        {bdayCount && (
                                            <h3>You share your birthday with at least {bdayCount} celebrities.<sup>*</sup></h3>
                                        )}
                                        <p>*This data is sourced from <a class='read-more-link' href='https://www.kaggle.com/datasets/dharun4772/celebrity-birthdays-full-calendar-year'>Kaggle.</a></p>
                                    </div>
                                    <div className="container">
                                        <h2>Historical events on your birthday:</h2>
                                        <p>WARNING: Some of these facts may be disturbing, a sentiment analysis algorithm is being considered to filter them out.</p>
                                        <div className="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">
                                            {onThisDay.map((fact, index) => (
                                                <div key={index} className="col">
                                                    <div className="card shadow-sm fadein">
                                                        {
                                                            fact.pages && fact.pages.length > 0 ? (
                                                                fact.pages.map((page, index) =>
                                                                    page.thumbnail ? (
                                                                        <img
                                                                            key={index}
                                                                            src={page.thumbnail.source}
                                                                            alt="Fact Thumbnail"
                                                                            className="card-img-top"
                                                                            style={{ height: '300px', objectFit: 'contain' }}
                                                                        />
                                                                    ) : null
                                                                ).find(image => image !== null) || (
                                                                    <div className='no-image d-flex align-items-center justify-content-center' style={{ height: '300px' }}>
                                                                        No image available.
                                                                    </div>
                                                                )
                                                            ) : (
                                                                <div className='no-image d-flex align-items-center justify-content-center' style={{ height: '300px' }}>
                                                                    No image available.
                                                                </div>
                                                            )
                                                        }

                                                        <div className="card-body">
                                                            <div className="card-text">
                                                                In <a class='read-more-link' target='_blank' href={`https://en.wikipedia.org/wiki/${fact.year}`}>{fact.year}</a>, {fact.text}{" "}
                                                                <hr />
                                                                <h5>Read more:</h5>
                                                                <ul>
                                                                    {fact.pages.map((page, index) => (
                                                                        <li><a class='read-more-link' target='_blank' href={page.content_urls.desktop.page}>{page.titles.normalized}</a></li>
                                                                    ))}
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                <p>Some interesting facts will appear here once you've selected your birthday!</p>
                            ))}
                    </div>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>

</body>

</html>